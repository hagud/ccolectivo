üìó MANUAL T√âCNICO COMPLETO ‚Äî CAT√ÅLOGO COLECTIVO v6
√çndice general

Introducci√≥n

Arquitectura completa: c√≥mo funcionan las 7 herramientas juntas

Manual de uso herramienta por herramienta

3.1 colectivo_v6_mini.py

3.2 colectivo_v6_monitor.py

3.3 run_test_v5.sh

3.4 convertir_xml_a_mrc.py

3.5 analizador_clusters_v2.py

3.6 dashboard_ulra.py

3.7 analizar.py

Flujo de trabajo recomendado (pipeline completo)

Interpretaci√≥n de resultados

Diagn√≥stico, rendimiento y RAM

Errores frecuentes y soluciones

Ejemplos pr√°cticos listos para copiar

Pr√≥ximos pasos (fuentes, ampliaciones, clustering avanzado, IA)

üî∞ 1. INTRODUCCI√ìN

Tu sistema de cat√°logo colectivo es una soluci√≥n completa y modular para:

fusionar cat√°logos MARC de m√∫ltiples instituciones,

detectar duplicados internos y externos,

aplicar clustering fuerte + fuzzy muy optimizado,

analizar calidad de la fusi√≥n,

mostrar resultados visuales en dashboards HTML avanzados,

diagnosticar rendimiento y consumo de RAM.

Este manual describe en profundidad c√≥mo utilizarlo, c√≥mo funcionan sus algoritmos, y c√≥mo integrar todas las herramientas.

üèóÔ∏è 2. ARQUITECTURA COMPLETA DEL SISTEMA

Las herramientas que has subido se organizan as√≠:

Capa 1 ‚Äî Procesamiento y creaci√≥n del colectivo
‚öôÔ∏è colectivo_v6_mini.py (motor principal)

colectivo_v6_mini

Hace todo el trabajo complejo:

leer MARC por streaming

normalizar autor/t√≠tulo/a√±o

detectar claves fuertes (ISBN/ISSN)

generar clave fuzzy con RapidFuzz

agrupar registros en clusters

seleccionar registro primario

fusionar campos MARC

generar XML, CSV, JSON

Capa 2 ‚Äî Diagn√≥stico y an√°lisis interno
üîç colectivo_v6_monitor.py

colectivo_v6_monitor


Igual que v6_mini, pero a√±adiendo:

tiempos de fase

memoria antes/despu√©s

picos de RAM

histogramas

fuzzy: bucket sizes, comparaci√≥n real vs. prefiltro

log humano estructurado

Capa 3 ‚Äî Automatizaci√≥n del pipeline
üñ•Ô∏è run_test_v5.sh

run_test_v5


Ejecuta autom√°ticamente 12 modos distintos.

Capa 4 ‚Äî Conversi√≥n y preparaci√≥n de fuentes
üîÑ convertir_xml_a_mrc.py

convertir_xml_a_mrc


Convierte MARCXML ‚Üí MRC para maximizar el rendimiento.

Capa 5 ‚Äî An√°lisis profundo de clusters
üß™ analizador_clusters_v2.py

analizador_clusters_v2


Analiza un cluster concreto y genera:

HTML profesional

CSV

XML

an√°lisis campo a campo

tabla de bibliotecas implicadas

detecci√≥n de conflictos

Capa 6 ‚Äî Dashboard global HTML
üìä dashboard_ulra.py

dashboard_ulra


Genera:

dashboard_index.html

dashboard_<fase>.html

Con datos como:

% clusters multi-biblioteca

% clusters >10, >25, >50

niveles de riesgo

heatmap entre bibliotecas

duplicados internos

interbibliotecas

Capa 7 ‚Äî An√°lisis general r√°pido
üß∞ analizar.py

Conjunto de utilidades para inspeccionar registros, JSON, filtros, etc.

üß≠ 3. MANUAL HERRAMIENTA POR HERRAMIENTA
3.1 colectivo_v6_mini.py ‚Äî MANUAL COMPLETO

colectivo_v6_mini

¬øQu√© es?

El script principal que genera el cat√°logo colectivo desde MARC binario.

C√≥mo funciona internamente

Lee los .mrc por streaming ‚Üí RAM m√≠nima

Para cada registro:

extrae local_id

obtiene:

autor

t√≠tulo

a√±o

ISBN/ISSN

construye:

strong_key (si existe ISBN/ISSN v√°lido)

fuzzy_key (autor+t√≠tulo+a√±o normalizados)

Los registros se agrupan:

primero por strong_key

despu√©s por fuzzy_key

finalmente por similitud RapidFuzz

Para cada cluster:

se selecciona un registro primario

se a√±aden campos:

prov_tag (por defecto 977)

hold_tag (por defecto 978)

Se exportan:

XML ‚Üí cat√°logo colectivo

CSV ‚Üí resumen

JSON ‚Üí detalle completo para an√°lisis

Par√°metros principales
--src LIBX=fichero.mrc       # Bibliotecas y sus ficheros
--no-fuzzy                   # Solo clustering fuerte
--strong-only                # Exclusivo ISBN/ISSN
--weak-threshold XX          # Nivel de similitud fuzzy
--prefer-fields              # Prefiere campos 245/260/264
--alt-tags                   # Usa etiquetas alternativas
--keep9xx                    # Conserva 9xx
--final-pipeline             # Pipeline recomendado
--out                        # XML final
--report                     # CSV resumen
--clusters-json              # JSON completo

Ejemplo de ejecuci√≥n
python3 colectivo_v6_mini.py \
  --src LIB1=agn.mrc \
  --src LIB2=bnphu.mrc \
  --src LIB3=unphu.mrc \
  --src LIB4=intec.mrc \
  --out tests_output/03_fuzzy_standard.xml \
  --report tests_output/03_fuzzy_standard.csv \
  --clusters-json tests_output/03_fuzzy_standard.json \
  --weak-threshold 85

3.2 colectivo_v6_monitor.py ‚Äî MANUAL COMPLETO

colectivo_v6_monitor

Concepto

Es el mismo script que v6_mini, pero SE MONITORIZA TODO:

tiempo por fase

RAM antes/despu√©s

delta de memoria

fuzzy: comparaciones reales vs. descartes

histogramas de clusters

tracemalloc: l√≠neas que m√°s memoria consumen

Archivos generados (carpeta logs/)

performance.log

memory_peaks.log

fuzzy_stats.log

cluster_histogram.log

structures_sizes.log

summary_readable.log ‚úî resumen legible

Uso

Exactamente igual que colectivo_v6_mini.py

3.3 run_test_v5.sh ‚Äî MANUAL COMPLETO

run_test_v5

Funci√≥n

Ejecuta autom√°ticamente 12 modos del pipeline.

Men√∫

Incluye:

ejecutar 01, 02, ..., 12

modo manual

A ‚Üí ejecutar todas las fases

Resultado

Genera autom√°ticamente:

tests_output/
  01_strong_only.*
  02_fuzzy_safe.*
  03_fuzzy_standard.*
  ...
  12_fuzzy_marc_99.*


Cada fase incluye:

XML

CSV

JSON

3.4 convertir_xml_a_mrc.py ‚Äî MANUAL COMPLETO

convertir_xml_a_mrc

Uso
python3 convertir_xml_a_mrc.py archivo1.xml archivo2.xml


Requiere yaz:

sudo apt install yaz


Convierte any.xml ‚Üí any.mrc sin consumir RAM.

3.5 analizador_clusters_v2.py ‚Äî MANUAL COMPLETO

analizador_clusters_v2

Prop√≥sito

Analizar un cluster concreto con m√°xima profundidad.

Genera

HTML con tabla comparativa

XML del cluster

CSV con valores por registro

an√°lisis por campo

detecta campos:

homog√©neos

mixtos

conflictivos

Comando ejemplo
python3 analizador_clusters_v2.py \
  --cluster 345 \
  --phase 03_fuzzy_standard \
  --fields 245 100 260 264 300 490 650 \
  --out-prefix analisis_345

3.6 dashboard_ulra.py ‚Äî MANUAL COMPLETO

dashboard_ulra

Qu√© genera
1) dashboard_index.html

Con:

resumen global por fase

ranking

riesgo

comparativas

2) dashboard_<fase>.html

Con:

duplicados por biblioteca

interbibliotecas

sospechosos

mapa de calor

gr√°ficas Plotly

Uso
python3 dashboard_ulra.py generar

3.7 analizar.py ‚Äî MANUAL COMPLETO

Utilidad general para:

buscar clusters

inspeccionar JSON

obtener registros LIB:ID

aplicar filtros r√°pidos

Se usa como backend por otras herramientas.

üß© 4. FLUJO DE TRABAJO RECOMENDADO
PASO 1 ‚Äî Preparar archivos (si son XML)
python3 convertir_xml_a_mrc.py biblioteca.xml

PASO 2 ‚Äî Ejecutar el pipeline completo
bash run_test_v5.sh


Selecciona:

A) Todos los modos

PASO 3 ‚Äî Analizar resultados globales
python3 dashboard_ulra.py generar


Abrir:

dashboard_index.html

PASO 4 ‚Äî Analizar clusters sospechosos

Ejemplo:

python3 analizador_clusters_v2.py ... 

PASO 5 ‚Äî Revisi√≥n bibliotecas conflictivas

duplicados internos

interbibliotecas

clusters > 25

clustering fuerte demasiado estricto o demasiado permisivo

üìä 5. INTERPRETAR LOS RESULTADOS
CSV (por fase)

Columnas t√≠picas:

cluster_id

size

libraries (LIB1;LIB4‚Ä¶)

weak_key

strong_key

fuzzy_similarity

primary_lib

primary_id

JSON

Para an√°lisis avanzado:

[
  {
    "cluster_id": 1,
    "members": [
      {"lib": "AGN", "local_id": "1234", ...},
      {"lib": "UNPHU", "local_id": "5872", ...}
    ]
  }
]

HTML de dashboard

Incluye:

% de clusters tama√±o 1

% multi-biblioteca

tama√±o m√°ximo

riesgo (bajo, medio, alto)

score del modelo

üß† 6. DIAGN√ìSTICO DE RAM

Usa:

logs/memory_peaks.log
logs/summary_readable.log


Revisa:

picos de RAM por fase

fases que m√°s consumen durante fuzzy

bucket sizes demasiado grandes ‚Üí ajustar threshold

üõ†Ô∏è 7. ERRORES FRECUENTES
Error	Causa	Soluci√≥n
UnicodeDecodeError	archivo corrupto	convertir a UTF-8
MemoryError	usar XML	convertir a MRC
clustering excesivo	threshold bajo	subir weak-threshold
pocos clusters multi	threshold alto	bajar weak-threshold
üìù 8. EJEMPLOS DE USO LISTOS PARA COPIAR
Pipeline completo
bash run_test_v5.sh

Dashboard
python3 dashboard_ulra.py generar

Cluster concreto
python3 analizador_clusters_v2.py --cluster 123 --phase 03_fuzzy_standard

üöÄ 9. ¬øQUIERES EL DOCUMENTO EN PDF?

Puedo generarlo ahora mismo con:

portada

√≠ndice autom√°tico

estilo profesional

tablas

ejemplos

incluso modo ‚Äúmanual corporate‚Äù para clientes

Solo dime:

üìå ¬øQuieres el PDF ya?
üìå ¬øFormato espa√±ol o catal√°n?
